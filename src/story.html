<!doctype html>
<html lang="en-US">
<head>
  <%= t.include("partials/_head.html", grunt.data.json) %>
  <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
  <%= t.include("partials/_main_nav.html") %>

  <div class="container top-margin ">
    <div id="story-page">
      <div class="row">
        <div class="eight columns offset-by-two">
            <h1><%= archieml.TesterStoryforWatershed.headline %></h1>
            <div class="wave-divider"></div>
            <div class="authors"><%= archieml.TesterStoryforWatershed.author %></div>
            <div class="org"><%= archieml.TesterStoryforWatershed.organization %></div>
            <div class="date"><%= archieml.TesterStoryforWatershed.pub %></div>
        </div>
      </div>
    </div>
  </div>

  <img alt="#" src="<%= archieml.TesterStoryforWatershed.feature_img.src %>" />

  <div class="container">
    <div class="row">
      <div class="eight columns offset-by-two">
        <div id="caption"><%= archieml.TesterStoryforWatershed.feature_img.caption %><</div>
      </div>
    </div>
  </div>

  <div class="container share-icons-container">
    <div class="row">
      <div class="eight columns offset-by-two">
        <a href="#"><i class="fab fa-twitter share-icons"></i></a><a href="#"><i class="fab fa-facebook-f fa-lg share-icons"></i></a><a href="#"><i class="fas fa-envelope share-icons"></i></a>
      </div>
    </div>
  </div>

  <div class="container">
      <div class="row">
        <div class="eight columns offset-by-two">
          <div id="story-page-body">
            <% archieml.TesterStoryforWatershed.sections.forEach(function(section, i) { %>
            
              <% if(section.type == "text"){ %>
                <p> <%= t.renderMarkdown(section.value) %> </p>
                
              <% }else if(section.type == "h2"){ %>
                <h2><%= section.value %></h2>
                <div class="wave-divider-inline"></div>
                
              <% }else if(section.type == "pullquote"){ %>
                <h3><%= section.value %></h3>
                <div class="wave-divider-pullquote">
                  <span></span>
                  <a href="#"><i class="fab fa-twitter fa-lg"></i></a>
                  <a href="#"><i class="fab fa-facebook-f fa-lg"></i></a>
                </div>
                
              <% }else if(section.type == "story_photo_grid"){ %>
                </div> <!-- close story-page-body-->
                </div> <!-- close eight columns-->
                </div> <!-- close row-->
                </div> <!-- close container-->
                
                <div id="story-photo-grid">
                  <div>
                    <img alt="#" src="<%= section.value.top_left %>" />
                  </div>
                  <div>
                    <img alt="#" src="<%= section.value.top_right %>" />
                  </div>
                </div>
                <div id="photo-container">
                  <img alt="#" src="<%= section.value.big_bottom %>" />
                </div>
                <div class="container">
                  <div class="row">
                    <div class="eight columns offset-by-two">
                      <div id="caption"><%= section.value.caption %></div>
                    </div>
                  </div>
                </div>
                <div class="container">
                  <div class="row">
                    <div class="eight columns offset-by-two">
                      <div id="story-page-body">
                        
              <% }else if(section.type == "parallax_img"){ %>
                </div> <!-- close story-page-body-->
                </div> <!-- close eight columns-->
                </div> <!-- close row-->
                </div> <!-- close container-->
                
                <div class="parallax-divider">
                  <div class="block">
                    <img src="<%= section.value.src %>" data-speed="-1" class="img-parallax" />
                    <img alt="#" src="https://ps-apps-assets.s3.amazonaws.com/watershed/wavy-lines-v3.png" />
                  </div>
                </div>
                
                <div class="container">
                  <div class="row">
                    <div class="eight columns offset-by-two">
                      <div id="story-page-body">
              <% } %>
              
            <% }); %> 
        </div>
      </div>
    </div>
  </div>


  <%= t.include("partials/_footer.html") %>


  <script src="app.js" async></script>
  <script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>
  <%= t.include("partials/_analytics.html") %>

  <script>
    $('.img-parallax').each(function(){
      var img = $(this);
      var imgParent = $(this).parent();
      function parallaxImg () {
        var speed = img.data('speed');
        var imgY = imgParent.offset().top;
        var winY = $(this).scrollTop();
        var winH = $(this).height();
        var parentH = imgParent.innerHeight();


        // The next pixel to show on screen
        var winBottom = winY + winH;

        // If block is shown on screen
        if (winBottom > imgY && winY < imgY + parentH) {
          // Number of pixels shown after block appear
          var imgBottom = ((winBottom - imgY) * speed);
          // Max number of pixels until block disappear
          var imgTop = winH + parentH;
          // Porcentage between start showing until disappearing
          var imgPercent = ((imgBottom / imgTop) * 100) + (50 - (speed * 50));
        }
        img.css({
          top: imgPercent + '%',
          transform: 'translate(-50%, -' + imgPercent + '%)'
        });
      }
      $(document).on({
        scroll: function () {
          parallaxImg();
        }, ready: function () {
          parallaxImg();
        }
      });
    });
  </script>

</body>
</html>
